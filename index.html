<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Treasure Hunt</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url("assets/sea-bg.jpg") no-repeat center/cover;
  min-height: 100vh;
  color: white;
}

.overlay {
  background: rgba(0,0,0,0.45);
  min-height: 100vh;
  padding: 20px 10px;
  box-sizing: border-box;
  text-align: center;
}

h1 {
  margin-top: 10px;
}

#grid {
  display: grid;
  grid-template-columns: repeat(5, minmax(50px, 1fr));
  gap: clamp(8px, 2vw, 12px);
  max-width: 420px;
  margin: 30px auto;
}

.cell {
  aspect-ratio: 1 / 1;
  background: #c68642;
  border-radius: 14px;
  font-size: clamp(18px, 4vw, 26px);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: inset 0 0 6px rgba(0,0,0,.6);
}

.cell.opened {
  background: #7f8c8d;
  cursor: default;
}

#message {
  margin-top: 20px;
  font-size: 18px;
}

/* MODAL */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.modal-content {
  background: #1e3c5a;
  padding: 20px;
  border-radius: 16px;
  width: min(90%, 360px);
}

.modal-content h3 {
  margin-bottom: 15px;
}

.modal-content button {
  width: 100%;
  margin-top: 10px;
  padding: 12px;
  border-radius: 10px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}

.hidden {
  display: none;
}

.sound-btn {
  position: fixed;
  top: 10px;
  right: 10px;
  padding: 8px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}
</style>
</head>

<body>
<div class="overlay">
  <h1>üè¥‚Äç‚ò†Ô∏è Treasure Hunt</h1>
  <p>Click √¥ ‚Üí l√†m tr·∫Øc nghi·ªám ‚Üí t√¨m kho b√°u</p>

  <div id="grid"></div>
  <div id="message"></div>
</div>

<button class="sound-btn" onclick="toggleSound()">üîä</button>

<!-- MODAL -->
<div id="quizModal" class="modal hidden">
  <div class="modal-content">
    <h3 id="quizQuestion"></h3>
    <div id="quizChoices"></div>
  </div>
</div>

<!-- AUDIO -->
<audio id="seaSound" src="assets/sounds/sea.mp3" loop></audio>
<audio id="correctSound" src="assets/sounds/correct.mp3"></audio>
<audio id="treasureSound" src="assets/sounds/treasure.mp3"></audio>

<script>
const size = 5;
let treasureIndex = Math.floor(Math.random() * size * size);

let questionPool = [];
let currentCell = null;
let currentIndex = null;
let started = false;

const grid = document.getElementById("grid");
const message = document.getElementById("message");

const seaSound = document.getElementById("seaSound");
const correctSound = document.getElementById("correctSound");
const treasureSound = document.getElementById("treasureSound");

seaSound.volume = 0.25;
correctSound.volume = 0.8;
treasureSound.volume = 1;

// Load questions
fetch("questions.json")
  .then(res => res.json())
  .then(data => {
    questionPool = [...data];
    createGrid();
  });

function createGrid() {
  for (let i = 0; i < size * size; i++) {
    const cell = document.createElement("div");
    cell.className = "cell";
    cell.onclick = () => doMission(cell, i);
    grid.appendChild(cell);
  }
}

function startSound() {
  if (!started) {
    seaSound.play();
    started = true;
  }
}

function toggleSound() {
  seaSound.muted = !seaSound.muted;
}

function getRandomQuestion() {
  if (questionPool.length === 0) {
    alert("H·∫øt c√¢u h·ªèi r·ªìi!");
    return null;
  }
  const index = Math.floor(Math.random() * questionPool.length);
  return questionPool.splice(index, 1)[0];
}

function doMission(cell, index) {
  if (cell.classList.contains("opened")) return;

  startSound();

  const q = getRandomQuestion();
  if (!q) return;

  currentCell = cell;
  currentIndex = index;

  document.getElementById("quizQuestion").textContent = q.question;
  const choicesDiv = document.getElementById("quizChoices");
  choicesDiv.innerHTML = "";

  q.choices
    .sort(() => Math.random() - 0.5)
    .forEach(choice => {
      const btn = document.createElement("button");
      btn.textContent = choice;
      btn.onclick = () => checkAnswer(choice, q.answer);
      choicesDiv.appendChild(btn);
    });

  document.getElementById("quizModal").classList.remove("hidden");
}

function checkAnswer(choice, answer) {
  document.getElementById("quizModal").classList.add("hidden");

  if (choice === answer) {
    correctSound.currentTime = 0;
    correctSound.play();
    openCell(currentCell, currentIndex);
  } else {
    alert("‚ùå Sai r·ªìi!");
  }
}

function openCell(cell, index) {
  cell.classList.add("opened");

  if (index === treasureIndex) {
    cell.textContent = "üí∞";
    treasureSound.play();
    seaSound.pause();
    message.textContent = "üéâ B·∫°n ƒë√£ t√¨m th·∫•y kho b√°u!";
    endGame();
  } else {
    cell.textContent = "‚ùå";
  }
}

function endGame() {
  document.querySelectorAll(".cell").forEach(c => c.onclick = null);
}
</script>
</body>
  </html>
